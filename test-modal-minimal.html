<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal Minimal</title>
    <style>
        body { 
            padding: 40px; 
            font-family: Arial, sans-serif; 
            margin: 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999999;
        }
        
        .modal.visible {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
        }
        
        button {
            padding: 12px 24px;
            margin: 8px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .primary { background: #007bff; color: white; }
        .secondary { background: #6c757d; color: white; }
        .danger { background: #dc3545; color: white; }
        
        .logs {
            background: #f8f9fa;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 20px 0;
            height: 200px;
            overflow-y: auto;
            white-space: pre-line;
        }
        
        .status {
            font-weight: bold;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .status.open { background: #d4edda; color: #155724; }
        .status.closed { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üîç Test Modal Minimal - Sans CSS externe</h1>
    
    <div class="status closed" id="status">Modal ferm√©</div>
    
    <button class="primary" onclick="openModal()">Ouvrir Modal</button>
    <button class="secondary" onclick="checkModal()">V√©rifier √âtat</button>
    <button class="danger" onclick="forceClose()">Forcer Fermeture</button>
    
    <div class="logs" id="logs">Logs:\n</div>

    <!-- Modal minimal -->
    <div class="modal" id="testModal">
        <div class="modal-content">
            <h3>üéØ Modal de Test Minimal</h3>
            <p><strong>Si vous voyez ceci, le modal est ouvert !</strong></p>
            <p>Ce modal utilise uniquement du CSS et JS basique.</p>
            <div>
                <button class="secondary" onclick="closeModal()">Fermer Modal</button>
                <button class="primary" onclick="keepOpen()">Rester Ouvert</button>
            </div>
        </div>
    </div>

    <script>
        let modalState = 'closed';
        let logCount = 0;
        
        function log(message) {
            const logsDiv = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            logCount++;
            logsDiv.textContent += `[${logCount}] [${time}] ${message}\n`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(`[${logCount}] ${message}`);
        }
        
        function updateStatus(state) {
            modalState = state;
            const statusDiv = document.getElementById('status');
            if (state === 'open') {
                statusDiv.textContent = '‚úÖ Modal OUVERT';
                statusDiv.className = 'status open';
            } else {
                statusDiv.textContent = '‚ùå Modal FERM√â';
                statusDiv.className = 'status closed';
            }
            log(`√âtat modal: ${state}`);
        }
        
        function openModal() {
            log('üöÄ Tentative d\'ouverture du modal...');
            const modal = document.getElementById('testModal');
            
            if (modal) {
                // M√©thode 1: Classe CSS
                modal.classList.add('visible');
                log('‚úÖ Classe "visible" ajout√©e');
                
                // M√©thode 2: Style inline pour forcer
                modal.style.display = 'flex';
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.zIndex = '999999';
                modal.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                
                log('‚úÖ Styles inline appliqu√©s');
                updateStatus('open');
                
                // V√©rifier imm√©diatement
                setTimeout(() => {
                    const computed = window.getComputedStyle(modal);
                    const isVisible = computed.display !== 'none' && modal.offsetWidth > 0;
                    log(`V√©rification imm√©diate: visible=${isVisible}, display=${computed.display}`);
                    
                    if (!isVisible) {
                        log('‚ùå PROBL√àME: Modal pas visible apr√®s ouverture!');
                        updateStatus('closed');
                    }
                }, 10);
                
                // V√©rifier apr√®s 1 seconde
                setTimeout(() => {
                    const computed = window.getComputedStyle(modal);
                    const isVisible = computed.display !== 'none' && modal.offsetWidth > 0;
                    log(`V√©rification 1s: visible=${isVisible}, display=${computed.display}`);
                    
                    if (!isVisible) {
                        log('‚ùå Modal s\'est ferm√© automatiquement apr√®s 1s!');
                        updateStatus('closed');
                    }
                }, 1000);
                
            } else {
                log('‚ùå Modal non trouv√© dans le DOM!');
            }
        }
        
        function closeModal() {
            log('üîê Fermeture manuelle du modal...');
            const modal = document.getElementById('testModal');
            if (modal) {
                modal.classList.remove('visible');
                modal.style.display = 'none';
                updateStatus('closed');
                log('‚úÖ Modal ferm√© manuellement');
            }
        }
        
        function checkModal() {
            log('üîç V√©rification de l\'√©tat du modal...');
            const modal = document.getElementById('testModal');
            if (modal) {
                const computed = window.getComputedStyle(modal);
                const rect = modal.getBoundingClientRect();
                
                log(`Classes: "${modal.className}"`);
                log(`Style.display: "${modal.style.display}"`);
                log(`Computed.display: "${computed.display}"`);
                log(`Computed.visibility: "${computed.visibility}"`);
                log(`Computed.opacity: "${computed.opacity}"`);
                log(`BoundingRect: ${rect.width}x${rect.height}`);
                log(`OffsetDimensions: ${modal.offsetWidth}x${modal.offsetHeight}`);
                
                const isVisible = computed.display !== 'none' && modal.offsetWidth > 0;
                updateStatus(isVisible ? 'open' : 'closed');
            }
        }
        
        function keepOpen() {
            log('üîí Tentative de maintenir le modal ouvert...');
        }
        
        function forceClose() {
            log('üí• Fermeture forc√©e...');
            closeModal();
        }
        
        // Intercepter TOUS les √©v√©nements pour voir ce qui se passe
        let eventCount = 0;
        document.addEventListener('click', function(e) {
            eventCount++;
            log(`[${eventCount}] Clic sur: ${e.target.tagName}.${e.target.className || 'no-class'}`);
        }, true);
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                log('Touche Escape press√©e');
            }
        });
        
        // Surveiller les mutations DOM
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.target.id === 'testModal') {
                    log(`Mutation DOM d√©tect√©e: ${mutation.type} - ${mutation.attributeName || 'childList'}`);
                }
            });
        });
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            log('üìÑ Page charg√©e - Test modal minimal initialis√©');
            
            const modal = document.getElementById('testModal');
            if (modal) {
                observer.observe(modal, {
                    attributes: true,
                    attributeOldValue: true,
                    childList: true,
                    subtree: true
                });
                log('üëÅÔ∏è Observer DOM attach√© au modal');
            }
            
            updateStatus('closed');
            
            // Test automatique apr√®s 2 secondes
            setTimeout(() => {
                log('ü§ñ Test automatique dans 2s...');
                openModal();
            }, 2000);
        });
    </script>
</body>
</html>