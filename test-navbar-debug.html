<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Debug Navbar</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        .debug-panel {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .log-output {
            background: #1e1e1e;
            color: #fff;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .test-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            background: #007ACC;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #005a9e;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h2>üîç Test Debug Navbar System</h2>
        
        <div class="test-buttons">
            <button onclick="testNavbarLoader()">Tester NavbarLoader</button>
            <button onclick="testDOMInjection()">Tester Injection DOM</button>
            <button onclick="testFetch()">Tester Fetch navbar.html</button>
            <button onclick="clearLogs()">Effacer les logs</button>
        </div>

        <div id="status-display">
            <p><span id="fetch-status" class="status-indicator"></span>Fetch navbar.html: <span id="fetch-text">Non test√©</span></p>
            <p><span id="loader-status" class="status-indicator"></span>NavbarLoader: <span id="loader-text">Non test√©</span></p>
            <p><span id="dom-status" class="status-indicator"></span>DOM Injection: <span id="dom-text">Non test√©</span></p>
        </div>

        <h3>üìã Logs en temps r√©el</h3>
        <div id="log-output" class="log-output"></div>
    </div>

    <div class="debug-panel">
        <h3>üåê Zone d'injection de la navbar</h3>
        <div id="navbar-container" style="border: 2px dashed #ccc; min-height: 100px; padding: 20px;">
            <p style="color: #666; text-align: center;">La navbar appara√Ætra ici...</p>
        </div>
    </div>

    <script>
        // Syst√®me de logging personnalis√©
        const logContainer = document.getElementById('log-output');
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;

        function customLog(level, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.join(' ');
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '4px';
            
            let color = '#fff';
            let prefix = '';
            
            switch(level) {
                case 'log': color = '#fff'; prefix = 'üí¨'; break;
                case 'warn': color = '#ffc107'; prefix = '‚ö†Ô∏è'; break;
                case 'error': color = '#dc3545'; prefix = '‚ùå'; break;
            }
            
            logEntry.innerHTML = `<span style="color: #666;">${timestamp}</span> <span style="color: ${color};">${prefix} ${message}</span>`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        console.log = (...args) => {
            originalLog.apply(console, args);
            customLog('log', ...args);
        };

        console.warn = (...args) => {
            originalWarn.apply(console, args);
            customLog('warn', ...args);
        };

        console.error = (...args) => {
            originalError.apply(console, args);
            customLog('error', ...args);
        };

        function updateStatus(type, status, text) {
            const statusEl = document.getElementById(`${type}-status`);
            const textEl = document.getElementById(`${type}-text`);
            
            statusEl.className = `status-indicator status-${status}`;
            textEl.textContent = text;
        }

        async function testFetch() {
            console.log('üß™ Test de fetch navbar.html...');
            try {
                const response = await fetch('components/navbar.html');
                console.log('üì° R√©ponse re√ßue, statut:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const html = await response.text();
                console.log('‚úÖ HTML re√ßu, longueur:', html.length, 'caract√®res');
                console.log('üìÑ D√©but du HTML:', html.substring(0, 200) + '...');
                
                updateStatus('fetch', 'success', `Succ√®s (${html.length} caract√®res)`);
                return html;
            } catch (error) {
                console.error('‚ùå Erreur lors du fetch:', error);
                updateStatus('fetch', 'error', '√âchec: ' + error.message);
                return null;
            }
        }

        async function testDOMInjection() {
            console.log('üß™ Test d\'injection DOM...');
            const container = document.getElementById('navbar-container');
            
            try {
                // R√©cup√©rer le HTML
                const html = await testFetch();
                if (!html) {
                    throw new Error('Impossible de r√©cup√©rer le HTML');
                }
                
                // Cr√©er un container temporaire
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                
                // Injecter dans notre zone de test
                container.innerHTML = '';
                while (tempDiv.firstChild) {
                    container.appendChild(tempDiv.firstChild);
                }
                
                console.log('‚úÖ Injection DOM r√©ussie');
                console.log('üîç Header pr√©sent:', !!container.querySelector('header'));
                console.log('üîç Menu overlay pr√©sent:', !!container.querySelector('.mobile-menu-overlay'));
                
                updateStatus('dom', 'success', 'Injection r√©ussie');
                
            } catch (error) {
                console.error('‚ùå Erreur lors de l\'injection:', error);
                updateStatus('dom', 'error', '√âchec: ' + error.message);
            }
        }

        async function testNavbarLoader() {
            console.log('üß™ Test de NavbarLoader...');
            try {
                // Charger le script NavbarLoader
                const script = document.createElement('script');
                script.src = 'components/navbar-loader.js';
                
                script.onload = () => {
                    console.log('‚úÖ Script navbar-loader.js charg√©');
                    
                    // Cr√©er une instance
                    if (window.NavbarLoader) {
                        console.log('üì¶ Cr√©ation d\'une instance NavbarLoader...');
                        const loader = new window.NavbarLoader({
                            autoInit: false,
                            debug: true
                        });
                        
                        // Test manuel
                        loader.init().then(() => {
                            console.log('‚úÖ NavbarLoader initialis√© avec succ√®s');
                            updateStatus('loader', 'success', 'Initialis√© avec succ√®s');
                        }).catch(error => {
                            console.error('‚ùå Erreur lors de l\'initialisation:', error);
                            updateStatus('loader', 'error', '√âchec init: ' + error.message);
                        });
                        
                    } else {
                        throw new Error('NavbarLoader non trouv√© dans window');
                    }
                };
                
                script.onerror = () => {
                    const error = 'Impossible de charger navbar-loader.js';
                    console.error('‚ùå', error);
                    updateStatus('loader', 'error', error);
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                console.error('‚ùå Erreur lors du test NavbarLoader:', error);
                updateStatus('loader', 'error', '√âchec: ' + error.message);
            }
        }

        function clearLogs() {
            logContainer.innerHTML = '';
        }

        // Log initial
        console.log('üöÄ Debug panel initialis√©');
    </script>
</body>
</html>
